<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<style>
    .chidden {
        display: none;
    }

    aside{
        display:block;
        position:fixed;
        top: 188px;
        width: 245px;
        height:auto;
        border: solid 2px #000000;
    }
</style>
<head>
    <link rel="stylesheet" href="/css/doc.css">
    <link rel="stylesheet" href="/css/doc/header.css">
    <link rel="stylesheet" href="/css/nav.css">

    <script src="https://cdn.ckeditor.com/4.21.0/standard/ckeditor.js"></script>
    <script type="text/javascript" src="/ckeditor/ckeditor.js"></script>

    <!--<link rel="stylesheet" href="/src/main/resources/static/css/doc.css">
    <link rel="stylesheet" href="/src/main/resources/static/css/doc/header.css">
    <link rel="stylesheet" href="/src/main/resources/static/css/nav.css">-->
    <title>[[${doc.d_title}]] - CS위키</title>
</head>
<body style="overflow-x: hidden">
    <div th:insert="/header :: header"></div>
    <aside>
        <ul>
            <li th:each="category : ${jsonData}">
                <span th:text="${category['name']}" class="category-toggle"></span>
                <ul class="chidden">
                    <li th:each="child : ${category['children']}">
                        <span th:text="${child['name']}" class="category-toggle"></span>
                        <ul class="chidden">
                            <li th:each="lastChild : ${child['children']}">
                                <a th:href="@{/doc/doc(d_num=${lastChild['d_num']})}" th:text="${lastChild['name']}"></a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
    </aside>
    <main>
        <div id="doc">
            <hr>
            <div class="doc_inner">
            <span class="title">[[${doc.d_title}]]</span>
                <div class="selectbox">
                    <ul>
                        <li>
                            <th:block th:if="${session.member != null}">
                                <a th:href="@{/doc/starcheck(d_num=${doc.d_num}, u_id=${session.member.u_id})}" id="star"style="cursor:pointer;">★</a>
                            </th:block>
                            <th:block th:unless="${session.member != null}">
                                ★
                            </th:block>
                        </li>
                        <li>
                            <th:block th:if="${session.member != null} and ${session.member.ban != null} and ${session.member.p_id >= doc.p_update}">
                                <th:block th:if="${session.member.ban == 1}">편집</th:block>
                                <th:block th:unless="${session.member.ban == 1}"><a th:href="@{/doc/edit(d_num=${doc.d_num})}">편집</a></th:block>
                            </th:block>
                            <th:block th:unless="${session.member != null} and ${session.member.ban != null} and ${session.member.p_id >= doc.p_update}">
                                편집
                            </th:block>
                        </li>
                        <li><a th:href="@{/doc/doc_history(d_num=${doc.d_num})}">역사</a></li>
                        <li>
                            <a th:href="@{/doc/acl(d_num=${doc.d_num})}">ACL</a>
                        </li>
                        <li>
                            <th:block th:if="${session.member != null} and ${session.member.ban != null} and ${session.member.p_id >= doc.p_delete}">
                                <a th:href="@{/doc/delete(d_num=${doc.d_num})}">삭제</a>
                            </th:block>
                            <th:block th:unless="${session.member != null} and ${session.member.ban != null} and ${session.member.p_id >= doc.p_delete}">
                                삭제
                            </th:block>
                        </li>
                    </ul>
                </div>
                <div class="doc_index_type">
                    <div id="doc_index">
                        <span class="doc_index_list">목차</span>
                    </div>
                </div>
                <div class="content">
                    <div th:if="${doc.p_read == 1} or ${session.member != null} and ${session.member.p_id >= doc.p_read}" th:utext="${doc.d_content}">
                    </div>
                    <div th:unless="${doc.p_read == 1} or ${session.member != null} and ${session.member.p_id >= doc.p_read}">
                        읽기 권한이 없습니다!
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript" src="/js/indexLink.js"></script>
    </main>
    <script>
        function toggleMenu() {
            var userInfo = document.getElementById("hmenu");
            userInfo.classList.toggle("mhidden");
        }
    </script>
    <script>
        document.getElementById("searchBtn").onclick = function () {
            let keyword =  document.getElementsByName("d_title")[0].value;
            console.log(title)
            location.href = "/doc/search" + "&title=" + title;
        }
    </script>
    <script>
        // JavaScript 코드
        var toggleButtons = document.querySelectorAll('.category-toggle');

        toggleButtons.forEach(function(button) {
            button.addEventListener('click', function() {
                var parentUl = button.parentElement.querySelector('ul');
                if (parentUl) {
                    if (parentUl.classList.contains('chidden')) {
                        parentUl.classList.remove('chidden');
                    } else {
                        parentUl.classList.add('chidden');
                    }
                }
            });
        });
    </script>
</body>
</html>