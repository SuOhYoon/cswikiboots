<!DOCTYPE html>
<html>
<head>
    <title>Category Data</title>
    <style>
        .hidden {
            display: none;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<ul>
    <form action="/addcategory" method="post">
        <input type="text" value="" name="name" placeholder="카테고리 이름 입력"/>
    </form>
    <li class="edit" th:each="category : ${jsonData}">
        <span th:text="${category['name']}" class="category-toggle category-parent"></span>
        <input type="hidden" name="name" class="parent-edit" th:value="${category['name']}">
        <ul class="hidden">
            <form action="/addsecondcategory" method="post">+
                <input type="text" value="" name="name" placeholder="카테고리 이름 입력"/>
                <input type="hidden" name="parent_id" id="parent"/>
            </form>
            <li th:each="child : ${category['children']}">
                <span th:text="${child['name']}" class="category-toggle category-child"></span>
                <span style="display:none" th:text="${child['id']}" class="category-child-id"></span>
                <ul class="hidden">
                    <li th:each="lastChild : ${child['children']}">
                        <a th:href="@{/doc/doc(d_num=${lastChild['d_num']})}" th:text="${lastChild['name']}"></a>
                    </li>
                </ul>
            </li>
        </ul>
    </li>
</ul>
<script>
    // JavaScript 코드
    var toggleButtons = document.querySelectorAll('.category-toggle');

    toggleButtons.forEach(function(button) {
        button.addEventListener('click', function() {
            var parentUl = button.parentElement.querySelector('ul');
            if (parentUl) {
                if (parentUl.classList.contains('hidden')) {
                    parentUl.classList.remove('hidden');
                } else {
                    parentUl.classList.add('hidden');
                }
            }

            var idElement = button.parentElement.querySelector('#p');
            if (idElement) {
                // 선택한 카테고리의 id 값을 가져와서 parent_id 필드에 할당
                var parentIdInput = button.parentElement.querySelector('input[name="parent_id"]');
                parentIdInput.value = idElement.textContent;
            }
        });
    });

    $(document).ready(function(){
        $('.category-parent').on('dblclick', function(){
            let name = $(this).text();
            $(this).remove();
            $('.edit').append("<input type='text' name='name' value='' class='parent-edit'>");
            $('.parent-edit').val(name);
        });
        $('.category-child').on('dblclick', function(){
            $(this).remove();
            $('#hiddenInput').prop('type', 'text');
        })
    });
</script>
</body>
</html>